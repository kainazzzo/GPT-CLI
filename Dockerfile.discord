# syntax=docker/dockerfile:1.5
FROM mcr.microsoft.com/dotnet/sdk:10.0 AS build
WORKDIR /src
COPY gpt.csproj ./
COPY GPT-CLI.sln ./
RUN --mount=type=cache,id=nuget,target=/root/.nuget/packages \
    dotnet restore gpt.csproj -r linux-x64

COPY . .
RUN --mount=type=cache,id=nuget,target=/root/.nuget/packages \
    dotnet publish gpt.csproj -c Release -r linux-x64 -o /app/publish --self-contained true -p:PublishSingleFile=true --no-restore

FROM redhat/ubi9
WORKDIR /app
RUN yum install -y libicu
COPY --from=build /app/publish .
# appsettings.json is mounted at runtime via docker-compose
ENV GPT__MODE="Discord"
ENV GPT__CHUNKSIZE="1536"
ENV GPT__MAXTOKENS="64000"
ENV GPT__MODEL="gpt-5.2"
ENTRYPOINT ./gpt discord
